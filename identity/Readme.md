# Plume系统 思路
## 注册
1. 我们在系统中提供User的注册界面或者批量生成的功能，用户会有用户名，密码，邮箱，职位等等基本信息，都保存找当前Org的数据库中。
2. 用户手机下载APP，在APP中输入用户名密码登录，然后生成公私钥。
3. APP把公钥发送到WebAPI服务器，在服务器生成证书请求，并发送给CA。CA颁发证书后返回给WebAPI服务器。服务器会保存一份证书到数据库表中，并把证书返回给APP，APP也保存一份。
4. 私钥和证书保存在APP内，也可以提供公私钥的备份和导出功能，让用户自己备份到其他地方。
## 登录
1. 用户打开Web，会跳转到登录页面，登录页面生成一个二维码，里面包含了一个随机生成的密钥。
2. 用户使用APP扫描这个二维码，用二维码中的密钥对证书和私钥加密，并将加密的结果发送到服务器。服务器会将加密的证书和私钥保存在内存中。
3. 服务器与浏览器通讯，拿到密钥，如果成功解密，那么说明登录成功，并通知浏览器，跳转到主页面。浏览器把密钥保存在Cookie中。
4. 服务器根据解密后的证书信息，可以拿到用户的相关信息，然后进行权限控制。
## 操作
用户在浏览器中登录成功后，APP即不需要再使用，APP只用于每次登录时使用。
1. 用户在浏览器中进行操作时，每次向服务器API发送请求，都需要带上密钥，放在请求的HTTP头中。
2. 服务器在获得浏览器发出的请求后，会用HTTP中的密钥对内存中的加密证书和私钥进行解密，然后用解密的证书和私钥进行各种事务操作。

## 私钥丢失
如果用户手机丢失，而且也找不到备份的证书和私钥了，那么需要使用新手机下载APP，然后使用用户名密码在APP登录，重新生成公私钥和证书。